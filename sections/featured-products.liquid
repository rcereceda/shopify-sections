{%- comment -%}
  Atomic Sections
  https://atomicsections.com
  License: MIT
  
  Featured Products Section
  
  A flexible section to showcase featured products from a collection.
  Perfect for highlighting bestsellers, new arrivals, or seasonal products.
  
  Features:
  - Select products from any collection
  - Customizable grid layout (2-4 columns)
  - Product cards with image, title, price, and sale badge
  - Quick view/add to cart button
  - Fully responsive design
  - Extensive customization options
{%- endcomment -%}

<div class="featured-products-section section-{{ section.id }}" style="
  padding-top: {{ section.settings.padding_top }}px;
  padding-bottom: {{ section.settings.padding_bottom }}px;
  background-color: {{ section.settings.background_color }};
">
  <div class="container" style="
    max-width: {{ section.settings.container_width }}px;
    margin: 0 auto;
    padding-left: 20px;
    padding-right: 20px;
  ">
    
    {%- if section.settings.heading != blank -%}
      <div class="section-header" style="text-align: {{ section.settings.heading_alignment }}; margin-bottom: {{ section.settings.heading_spacing }}px;">
        <h2 class="section-heading" style="
          color: {{ section.settings.heading_color }};
          font-size: {{ section.settings.heading_size_mobile }}px;
        ">
          {{ section.settings.heading }}
        </h2>
        {%- if section.settings.subheading != blank -%}
          <p class="section-subheading" style="
            color: {{ section.settings.subheading_color }};
            margin-top: 8px;
          ">
            {{ section.settings.subheading }}
          </p>
        {%- endif -%}
      </div>
    {%- endif -%}

    {%- liquid
      assign collection_handle = section.settings.collection
      assign products_limit = section.settings.products_limit
      
      if collection_handle != blank
        assign featured_collection = collections[collection_handle]
      else
        assign featured_collection = blank
      endif
    -%}

    {%- if featured_collection != blank and featured_collection.products.size > 0 -%}
      <div class="products-grid" style="
        display: grid;
        grid-template-columns: repeat({{ section.settings.columns_mobile }}, 1fr);
        gap: {{ section.settings.grid_gap }}px;
      ">
        {%- for product in featured_collection.products limit: products_limit -%}
          <div class="product-wrapper">
            <div class="product-card" style="
              background-color: {{ section.settings.card_background }};
              border: {{ section.settings.card_border_width }}px solid {{ section.settings.card_border_color }};
              border-radius: {{ section.settings.card_border_radius }}px;
              overflow: hidden;
              transition: transform 0.3s ease, box-shadow 0.3s ease;
            ">
              <a href="{{ product.url }}" class="product-card-link" style="text-decoration: none; color: inherit; display: block;">
              
              {%- comment -%} Product Image {%- endcomment -%}
              <div class="product-image-wrapper" style="
                position: relative;
                padding-bottom: {{ section.settings.image_ratio }}%;
                overflow: hidden;
                background-color: {{ section.settings.image_background }};
              ">
                {%- if product.featured_image -%}
                  {%- comment -%} Primary Image {%- endcomment -%}
                  <img
                    class="product-image-primary"
                    src="{{ product.featured_image | image_url: width: 600 }}"
                    srcset="
                      {{ product.featured_image | image_url: width: 300 }} 300w,
                      {{ product.featured_image | image_url: width: 600 }} 600w,
                      {{ product.featured_image | image_url: width: 900 }} 900w
                    "
                    sizes="(max-width: 767px) 50vw, 25vw"
                    alt="{{ product.featured_image.alt | escape }}"
                    width="{{ product.featured_image.width }}"
                    height="{{ product.featured_image.height }}"
                    loading="lazy"
                    style="
                      position: absolute;
                      top: 0;
                      left: 0;
                      width: 100%;
                      height: 100%;
                      object-fit: {{ section.settings.image_fit }};
                      transition: opacity 0.3s ease;
                    "
                  >
                  
                  {%- comment -%} Secondary Image (hover) {%- endcomment -%}
                  {%- if product.images[1] and section.settings.enable_image_hover -%}
                    <img
                      class="product-image-secondary"
                      src="{{ product.images[1] | image_url: width: 600 }}"
                      srcset="
                        {{ product.images[1] | image_url: width: 300 }} 300w,
                        {{ product.images[1] | image_url: width: 600 }} 600w,
                        {{ product.images[1] | image_url: width: 900 }} 900w
                      "
                      sizes="(max-width: 767px) 50vw, 25vw"
                      alt="{{ product.images[1].alt | escape }}"
                      width="{{ product.images[1].width }}"
                      height="{{ product.images[1].height }}"
                      loading="lazy"
                      style="
                        position: absolute;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        object-fit: {{ section.settings.image_fit }};
                        opacity: 0;
                        transition: opacity 0.3s ease;
                      "
                    >
                  {%- endif -%}
                {%- else -%}
                  <div style="
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    background-color: #f5f5f5;
                    color: #999;
                  ">
                    No image
                  </div>
                {%- endif -%}

                {%- comment -%} Sale Badge {%- endcomment -%}
                {%- if product.compare_at_price > product.price and section.settings.show_sale_badge -%}
                  {%- assign discount_percent = product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price -%}
                  <div class="sale-badge" style="
                    position: absolute;
                    top: 12px;
                    left: 12px;
                    background-color: {{ section.settings.sale_badge_color }};
                    color: {{ section.settings.sale_badge_text_color }};
                    padding: 6px 12px;
                    border-radius: 4px;
                    font-size: 12px;
                    font-weight: 600;
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                  ">
                    -{{ discount_percent }}%
                  </div>
                {%- endif -%}
              </div>

              {%- comment -%} Product Info {%- endcomment -%}
              <div class="product-info" style="padding: {{ section.settings.card_padding }}px;">
                
                {%- if section.settings.show_vendor and product.vendor != blank -%}
                  <p class="product-vendor" style="
                    font-size: 12px;
                    color: {{ section.settings.vendor_color }};
                    margin: 0 0 4px 0;
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                  ">
                    {{ product.vendor }}
                  </p>
                {%- endif -%}

                <h3 class="product-title" style="
                  color: {{ section.settings.title_color }};
                  font-size: {{ section.settings.title_size }}px;
                  margin: 0 0 8px 0;
                  line-height: 1.4;
                  font-weight: 600;
                  min-height: calc({{ section.settings.title_size }}px * 1.4 * 2);
                  display: -webkit-box;
                  -webkit-line-clamp: 2;
                  -webkit-box-orient: vertical;
                  overflow: hidden;
                ">
                  {{ product.title }}
                </h3>

                {%- if section.settings.show_description and product.description != blank -%}
                  <p class="product-description" style="
                    color: {{ section.settings.description_color }};
                    font-size: 14px;
                    margin: 0 0 12px 0;
                    line-height: 1.5;
                  ">
                    {{ product.description | strip_html | truncate: 80 }}
                  </p>
                {%- endif -%}

                <div class="product-price" style="
                  display: flex;
                  align-items: center;
                  gap: 8px;
                ">
                  <span class="price" style="
                    color: {{ section.settings.price_color }};
                    font-size: {{ section.settings.price_size }}px;
                    font-weight: 700;
                  ">
                    {{ product.price | money }}
                  </span>
                  
                  {%- if product.compare_at_price > product.price -%}
                    <span class="compare-price" style="
                      color: {{ section.settings.compare_price_color }};
                      font-size: {{ section.settings.price_size | minus: 2 }}px;
                      text-decoration: line-through;
                      opacity: 0.7;
                    ">
                      {{ product.compare_at_price | money }}
                    </span>
                  {%- endif -%}
                </div>
              </div>
            </a>
          </div>

          {%- comment -%} Button OUTSIDE card {%- endcomment -%}
          {%- if section.settings.show_button -%}
            <div class="product-button-outside" style="
              margin-top: 12px;
              opacity: 0;
              transform: translateY(-8px);
              transition: all 0.3s ease;
            ">
              <a href="{{ product.url }}" style="
                display: block;
                padding: 12px 24px;
                background-color: {{ section.settings.button_background }};
                color: {{ section.settings.button_text_color }};
                text-align: center;
                text-decoration: none;
                border-radius: {{ section.settings.button_border_radius }}px;
                font-weight: 600;
                font-size: 14px;
                text-transform: uppercase;
                letter-spacing: 0.5px;
              ">
                {{ section.settings.button_text }}
              </a>
            </div>
          {%- endif -%}
        </div>
        {%- endfor -%}
      </div>

      {%- if section.settings.show_view_all and collection_handle != blank -%}
        <div class="section-footer" style="
          text-align: center;
          margin-top: {{ section.settings.view_all_spacing }}px;
        ">
          <a href="{{ featured_collection.url }}" class="view-all-button" style="
            display: inline-block;
            padding: 14px 32px;
            background-color: {{ section.settings.view_all_background }};
            color: {{ section.settings.view_all_text_color }};
            text-decoration: none;
            border-radius: {{ section.settings.button_border_radius }}px;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border: 2px solid {{ section.settings.view_all_border_color }};
          ">
            {{ section.settings.view_all_text }}
          </a>
        </div>
      {%- endif -%}

    {%- else -%}
      <div class="empty-state" style="
        text-align: center;
        padding: 80px 20px;
        background-color: #f8f9fa;
        border: 2px dashed #dee2e6;
        border-radius: 12px;
      ">
        {%- if collection_handle == blank -%}
          <svg style="width: 64px; height: 64px; margin: 0 auto 20px; opacity: 0.3;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
          </svg>
          <h3 style="font-size: 20px; font-weight: 600; color: #212529; margin: 0 0 12px 0;">
            No Collection Selected
          </h3>
          <p style="font-size: 16px; color: #6c757d; margin: 0 0 8px 0; line-height: 1.5;">
            To display products, please select a collection in the section settings.
          </p>
          <p style="font-size: 14px; color: #868e96; margin: 0;">
            Click the section, then choose a collection from the "Collection" dropdown.
          </p>
        {%- else -%}
          <svg style="width: 64px; height: 64px; margin: 0 auto 20px; opacity: 0.3;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
          </svg>
          <h3 style="font-size: 20px; font-weight: 600; color: #212529; margin: 0 0 12px 0;">
            No Products Found
          </h3>
          <p style="font-size: 16px; color: #6c757d; margin: 0; line-height: 1.5;">
            The selected collection doesn't have any products yet.
          </p>
        {%- endif -%}
      </div>
    {%- endif -%}

  </div>
</div>

<style>
  .featured-products-section .product-card {
    cursor: pointer;
  }
  
  .featured-products-section .product-wrapper:hover .product-card {
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
  }

  .featured-products-section .product-button-outside {
    display: none !important;
  }

  .featured-products-section .product-wrapper:hover .product-card {
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
  }

  .featured-products-section .product-wrapper:hover .product-image-secondary {
    opacity: 1 !important;
  }

  .featured-products-section .view-all-button {
    transition: all 0.3s ease !important;
  }

  .featured-products-section .view-all-button:hover {
    background-color: #000000 !important;
    color: #ffffff !important;
    border-color: #000000 !important;
  }

  @media (min-width: 768px) {
    .featured-products-section .products-grid {
      grid-template-columns: repeat({{ section.settings.columns_desktop }}, 1fr) !important;
    }
    
    .featured-products-section .section-heading {
      font-size: {{ section.settings.heading_size_desktop }}px !important;
    }

    .featured-products-section .product-button-outside {
      display: block !important;
    }

    .featured-products-section .product-wrapper:hover .product-button-outside {
      opacity: 1 !important;
      transform: translateY(0) !important;
    }
  }
</style>

{% schema %}
{
  "name": "Featured Products",
  "tag": "section",
  "class": "section-featured-products",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Featured Products"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "Discover our most popular items"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection",
      "info": "Select the collection to display products from"
    },
    {
      "type": "range",
      "id": "products_limit",
      "min": 2,
      "max": 12,
      "step": 1,
      "label": "Maximum products to show",
      "default": 4
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "label": "Columns (mobile)",
      "options": [
        { "value": "1", "label": "1 column" },
        { "value": "2", "label": "2 columns" }
      ],
      "default": "1"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 2,
      "max": 4,
      "step": 1,
      "label": "Columns (desktop)",
      "default": 4
    },
    {
      "type": "range",
      "id": "grid_gap",
      "min": 8,
      "max": 48,
      "step": 4,
      "unit": "px",
      "label": "Gap between products",
      "default": 24
    },
    {
      "type": "range",
      "id": "container_width",
      "min": 1000,
      "max": 1600,
      "step": 50,
      "unit": "px",
      "label": "Container width",
      "default": 1200
    },
    {
      "type": "header",
      "content": "Heading Style"
    },
    {
      "type": "select",
      "id": "heading_alignment",
      "label": "Heading alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "default": "center"
    },
    {
      "type": "range",
      "id": "heading_size_mobile",
      "min": 20,
      "max": 48,
      "step": 2,
      "unit": "px",
      "label": "Heading size (mobile)",
      "default": 28
    },
    {
      "type": "range",
      "id": "heading_size_desktop",
      "min": 24,
      "max": 64,
      "step": 2,
      "unit": "px",
      "label": "Heading size (desktop)",
      "default": 36
    },
    {
      "type": "range",
      "id": "heading_spacing",
      "min": 16,
      "max": 64,
      "step": 4,
      "unit": "px",
      "label": "Space below heading",
      "default": 32
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "subheading_color",
      "label": "Subheading color",
      "default": "#666666"
    },
    {
      "type": "header",
      "content": "Product Card Style"
    },
    {
      "type": "color",
      "id": "card_background",
      "label": "Card background",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "card_border_width",
      "min": 0,
      "max": 4,
      "step": 1,
      "unit": "px",
      "label": "Card border width",
      "default": 1
    },
    {
      "type": "color",
      "id": "card_border_color",
      "label": "Card border color",
      "default": "#e5e5e5"
    },
    {
      "type": "range",
      "id": "card_border_radius",
      "min": 0,
      "max": 24,
      "step": 2,
      "unit": "px",
      "label": "Card border radius",
      "default": 8
    },
    {
      "type": "range",
      "id": "card_padding",
      "min": 8,
      "max": 32,
      "step": 2,
      "unit": "px",
      "label": "Card padding",
      "default": 16
    },
    {
      "type": "header",
      "content": "Product Image"
    },
    {
      "type": "checkbox",
      "id": "enable_image_hover",
      "label": "Show second image on hover",
      "default": true,
      "info": "If product has multiple images, show the second image on hover"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "label": "Image aspect ratio",
      "options": [
        { "value": "100", "label": "Square (1:1)" },
        { "value": "125", "label": "Portrait (4:5)" },
        { "value": "133", "label": "Portrait (3:4)" },
        { "value": "75", "label": "Landscape (4:3)" }
      ],
      "default": "100"
    },
    {
      "type": "select",
      "id": "image_fit",
      "label": "Image fit",
      "options": [
        { "value": "cover", "label": "Cover" },
        { "value": "contain", "label": "Contain" }
      ],
      "default": "cover"
    },
    {
      "type": "color",
      "id": "image_background",
      "label": "Image background color",
      "default": "#f5f5f5"
    },
    {
      "type": "header",
      "content": "Product Info"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show vendor",
      "default": false
    },
    {
      "type": "color",
      "id": "vendor_color",
      "label": "Vendor color",
      "default": "#999999"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "title_size",
      "min": 14,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Title size",
      "default": 16
    },
    {
      "type": "checkbox",
      "id": "show_description",
      "label": "Show product description",
      "default": false
    },
    {
      "type": "color",
      "id": "description_color",
      "label": "Description color",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "price_color",
      "label": "Price color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "price_size",
      "min": 14,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Price size",
      "default": 18
    },
    {
      "type": "color",
      "id": "compare_price_color",
      "label": "Compare at price color",
      "default": "#999999"
    },
    {
      "type": "header",
      "content": "Sale Badge"
    },
    {
      "type": "checkbox",
      "id": "show_sale_badge",
      "label": "Show sale badge",
      "default": true
    },
    {
      "type": "color",
      "id": "sale_badge_color",
      "label": "Sale badge background",
      "default": "#ff0000"
    },
    {
      "type": "color",
      "id": "sale_badge_text_color",
      "label": "Sale badge text color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Button"
    },
    {
      "type": "checkbox",
      "id": "show_button",
      "label": "Show button",
      "default": true
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "default": "Buy Now"
    },
    {
      "type": "color",
      "id": "button_background",
      "label": "Button background",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button text color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "button_border_radius",
      "min": 0,
      "max": 24,
      "step": 2,
      "unit": "px",
      "label": "Button border radius",
      "default": 4
    },
    {
      "type": "header",
      "content": "View All Button"
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "label": "Show 'View All' button",
      "default": true
    },
    {
      "type": "text",
      "id": "view_all_text",
      "label": "'View All' button text",
      "default": "Shop Now"
    },
    {
      "type": "range",
      "id": "view_all_spacing",
      "min": 24,
      "max": 80,
      "step": 4,
      "unit": "px",
      "label": "Space above button",
      "default": 48
    },
    {
      "type": "color",
      "id": "view_all_background",
      "label": "'View All' background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "view_all_text_color",
      "label": "'View All' text color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "view_all_border_color",
      "label": "'View All' border color",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Section Spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "Padding top",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "Padding bottom",
      "default": 60
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#f5f5f5"
    }
  ],
  "presets": [
    {
      "name": "Featured Products"
    }
  ]
}
{% endschema %}
